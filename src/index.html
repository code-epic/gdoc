<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Start your development with a Dashboard for Bootstrap 4.">
  <meta name="author" content="Creative Tim">
  <title>Gestión de Documentos</title>
  <!-- Favicon -->
  <link href="./assets/img/brand/favicon.ico" rel="icon" type="image/png">
  <!-- Fonts -->
  <!--  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">-->
  <!-- Icons -->
  <link href="./assets/vendor/nucleo/css/nucleo.css" rel="stylesheet">
  <link href="./assets/vendor/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">


  <!--  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">-->
  <!--  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">-->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1976d2">
</head>

<body class="mat-typography">
  <app-root></app-root>
  <noscript>Please enable JavaScript to continue using this application.</noscript>
</body>

<script>
  
  (function() {
    // Guardamos las referencias originales
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;
    const originalFetch = window.fetch;

    // Configuración: ID de la app (cambiar según corresponda en cada proyecto)
    // Puedes intentar obtenerlo dinámicamente si hay alguna variable global, 
    // sino default a 'external-app'
    const appId = window.APP_ID || 'external-app'; 

    /**
     * Envía el log al padre (Sandra Desktop container)
     */
    function sendToParent(type, message) {
      if (window.parent) {
        window.parent.postMessage({
          type: 'SDC_LOG',
          payload: {
            app_id: appId,
            log_type: type,
            message: message
          }
        }, '*');
      }
    }

    // 1. Interceptar Console
    console.log = function(...args) {
      originalLog.apply(console, args);
      sendToParent('INFO', args.join(' '));
    };

    console.error = function(...args) {
      originalError.apply(console, args);
      sendToParent('ERROR', args.join(' '));
    };
    
    console.warn = function(...args) {
      originalWarn.apply(console, args);
      sendToParent('WARN', args.join(' '));
    };

    // 2. Interceptar Fetch (Red)
    window.fetch = async function(...args) {
        const [resource] = args;
        const url = resource.toString();

        try {
            const response = await originalFetch(...args);
            
            // Lógica de Filtrado Estricta:
            // Solo reportar errores de servidor o cliente (4xx, 5xx)
            // Ignorar 200, 201, 204, etc.
            if (response.status >= 400) {
                sendToParent('FETCH', `Error HTTP ${response.status} en ${url}`);
            }
            
            return response;
        } catch (err) {
            // Si falla la red (offline, cors, dns) -> Reportamos error
            sendToParent('ERROR', `Fallo de Red: ${url} - ${err.message}`);
            throw err;
        }
    };

    // Notificar inicio
    sendToParent('INFO', `Monitor iniciado para ${appId}`);

})();


</script>

</html>